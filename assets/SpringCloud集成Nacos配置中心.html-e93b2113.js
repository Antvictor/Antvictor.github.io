import{_ as t,X as e,Y as p,$ as n,a0 as a,a2 as o,Z as c,C as i}from"./framework-2b931fd9.js";const l={},d=n("h1",{id:"版本选择",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#版本选择","aria-hidden":"true"},"#"),a(" 版本选择")],-1),u=n("code",null,"2022.0.0.0-RC1",-1),r={href:"https://github.com/alibaba/spring-cloud-alibaba/blob/2022.x/spring-cloud-alibaba-examples/nacos-example/nacos-discovery-example/readme-zh.md",target:"_blank",rel:"noopener noreferrer"},g=c(`<h1 id="配置中心" tabindex="-1"><a class="header-anchor" href="#配置中心" aria-hidden="true">#</a> 配置中心</h1><h2 id="引入依赖" tabindex="-1"><a class="header-anchor" href="#引入依赖" aria-hidden="true">#</a> 引入依赖</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2022.0.0.0-RC1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要注意：</p><ol><li>SpringBoot3.* 支持最低的JDK是17，要记得升级JDK版本哦！</li><li>为什么引入bootstrap？因为SpringCloud移除了，不引入加载配置文件会报错</li></ol><h2 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件" aria-hidden="true">#</a> 配置文件</h2><p><code>bootstrap.properties</code>|<code>bootstrap.yml</code></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>spring.cloud.nacos.config.server-addr: 127.0.0.1:8848  
spring.application.name=test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>配置中心必须在bootstrap中配置, 和服务发现一起用时也必须在bootstrap中配置，单独使用服务发现则可以在application中配置</strong></p><h2 id="动态配置" tabindex="-1"><a class="header-anchor" href="#动态配置" aria-hidden="true">#</a> 动态配置</h2><p>在进行配置之前需要注意一点，在dataId的配置上SpringCloud和SpringBoot是不同的，SpringBoot中可以直接配置dataId，而SpringCloud中dataId是由：<code>\${prefix}-\${spring.profies.active}.\${file-extension}</code>组成的。具体规则如下：</p><ul><li><code>\${prefix}</code> 是: <code>spring.applicatin.name</code> 或 <code>spring.cloud.nacos.config.prefix</code>. 同时存在时以<code>nacos</code>的配置为准</li><li><code>\${spring.profies.active}</code> 这个是SpringBoot的<code>spring.profies.active</code>配置，如果该配置不存在，那么<code>-\${spring.profies.active}</code>也不存在</li><li><code>\${file-extension}</code> 可以通过<code>spring.cloud.nacos.config.file-extension</code>进行配置，目前支持<code>properties</code>和<code>yaml</code>, 默认<code>properties</code>, 默认情况下，配置中心进行配置时，使用<code>\${prefix}</code> 或 <code>\${prefix}.properties</code>都可以，如果两个都存在，则<code>\${prefix}</code> 不生效</li></ul><h3 id="具体代码" tabindex="-1"><a class="header-anchor" href="#具体代码" aria-hidden="true">#</a> 具体代码</h3><p>正常写一个<code>controller</code>类，然后通过<code>@Value</code>注解读取信息</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/config&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 如果想自动刷新，则必须加该注解，这是SpringCloud的注解</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${name:hello}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> test<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> test<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动后进行测试。</p><h2 id="测试" tabindex="-1"><a class="header-anchor" href="#测试" aria-hidden="true">#</a> 测试</h2><p>测试步骤与上一篇SpringBoot的配置一样，需要注意的就是配置时使用的<code>dataId</code>需要按上述的规则使用。 首次查看，显示默认数据：</p><figure><img src="https://img.codejourney.top/img/20230420142433.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>根据规则配置dataId</p><figure><img src="https://img.codejourney.top/img/20230420142823.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>发布后测试：</p><figure><img src="https://img.codejourney.top/img/20230420142845.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>成功！！再次修改，将<code>Antvictor1</code>改为<code>Antvictor</code>发布：</p><figure><img src="https://img.codejourney.top/img/20230420142946.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>动态更新成功！</p><h2 id="结语" tabindex="-1"><a class="header-anchor" href="#结语" aria-hidden="true">#</a> 结语</h2><p>Nacos不愧是阿里的项目，更不愧是开源给了Spring家族，文档一如既往的残缺... Nacos的官方文档以及github中<code>SpringCloudAlibaba</code>里面的文档，都没有说需要引入<code>bootstrap</code>，而更坑的还在后面，服务发现里面也有几个依赖需要引入，但官方的文档提都没提, 必须研究他们的用例才能发现。</p>`,28);function k(v,m){const s=i("ExternalLinkIcon");return e(),p("div",null,[d,n("p",null,[a("版本选择最新的版本"),u,a("，学一样的新的东西最好直接学最新版。 "),n("a",r,[a("alibaba-cloud文档"),o(s)])]),g])}const h=t(l,[["render",k],["__file","SpringCloud集成Nacos配置中心.html.vue"]]);export{h as default};
